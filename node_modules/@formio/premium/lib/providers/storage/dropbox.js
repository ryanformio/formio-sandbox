import { Formio } from 'formiojs';
var Dropbox = /** @class */ (function () {
    function Dropbox(formio) {
        this.formio = formio;
    }
    Dropbox.prototype.uploadFile = function (file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId) {
        var _this = this;
        return new Formio.Promise((function (resolve, reject) {
            // Send the file with data.
            var xhr = new XMLHttpRequest();
            if (typeof progressCallback === 'function') {
                xhr.upload.onprogress = progressCallback;
            }
            var fd = new FormData();
            fd.append('name', fileName);
            fd.append('dir', dir);
            fd.append('file', file);
            // Fire on network error.
            xhr.onerror = function (err) {
                err.networkError = true;
                reject(err);
            };
            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status < 300) {
                    var response = JSON.parse(xhr.response);
                    response.storage = 'dropbox';
                    response.size = file.size;
                    response.type = file.type;
                    response.groupId = groupId;
                    response.groupPermissions = groupPermissions;
                    response.url = response.path_lower;
                    resolve(response);
                }
                else {
                    reject(xhr.response || 'Unable to upload file');
                }
            };
            xhr.onabort = reject;
            xhr.open('POST', _this.formio.formUrl + "/storage/dropbox");
            var token = _this.formio.getToken();
            if (token) {
                xhr.setRequestHeader('x-jwt-token', token);
            }
            xhr.send(fd);
        }));
    };
    Dropbox.prototype.downloadFile = function (file) {
        var token = this.formio.getToken();
        file.url =
            this.formio.formUrl + "/storage/dropbox?path_lower=" + file.path_lower + (token ? "&x-jwt-token=" + token : '');
        return Formio.Promise.resolve(file);
    };
    Dropbox.title = 'Dropbox';
    return Dropbox;
}());
export default Dropbox;
